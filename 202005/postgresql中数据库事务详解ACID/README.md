# 数据库事务详解
## 事务概述
	事务(Transaction)是由一系列对系统中数据进行访问与更新的操
	作所组成的一个程序执行逻辑单元。

	
	ACID 特性
	事务具有4个基本特征:分别是:原子性(Atomicity)，一致性(Consistency)，
	隔离性(isolation)，持久性(Duration)、简称(ACID)

	
	隔离级别
	ACID这4个特征中，最难理解的是隔离性，在标准SQL规范中，定义了4个事务隔离级别，
	不同的隔离级别对事务的处理不同。4个隔离级别分别是:读未提交(READ_UNCOMMITTED)，
	读已提交(READ_COMMITTED)，可重复读(REPEATABLE_READ)，顺序读(SERIALIZABLE)
	
	
	事务并发引发的问题
	数据库在不同的隔离级别下并发访问可能会出现以下几种问题：脏读(Dirty Read)、
	不可重复读(Unrepeatable Read)、幻读(Phantom Read)。
	
	
## 原子性(Atomicity)
	事务的原子性是指事务必须是一个原子的操作序列单元，事务中包含的各项操作在一次执行过程中，
	只允许出现两种状态之一。
	1、全部执行成功
	2、全部执行失败
	
	任何一项操作都会导致整个事务的失败，同时其他已经执行的操作都将被撤销并回滚，
	只有所有的操作全部成功，整个事务才算是成功完成。

## 一致性(Consistency)
	事务的一致性是指事务的执行不能破坏数据库的完整性和一致性，
	一个事务在执行之前和执行之后，数据库都必须除以一致性状态。

## 隔离性(lsolation)
	事务的隔离性是指在并发环境中，并发的事务是相互隔离的，一个事务的执行不能被其他事务干扰，
	也就是说。不同的事务并发操作相同的数据时，每个事务都有各自完整性的数据空间。
	
	一个事务内部的操作及使用的数据对其他并发事务是隔离性的，
	并发执行的各个事务是不能相互干扰的。
	
	
### 读未提交(READ_UNCOMMITTED)
	读未提交,该隔离级别允许脏读取，其隔离级别是最低的，换句话说，如果一个事务正在处理某一行数据，
	并对其进行了更新，但同时为提交完事务，因此还没有提交事务，而因此同时，允许另一个事务也能够访问数据。
	
	脏读实例
	在事务A和事务B同时执行时可能会出现以下的情况。
	
	时间	事务A(存款)				事务B(取款)
	T1		开始事务				----
	T2		----					开始事务
	T3		----					查询余额(1000元)
	T4		----					取出1000元(余额0元)
	T5		查询余额(0元)			----
	T6		----					撤销事务(余额恢复1000元)
	T7		存入500元(余额500元)	----
	T8		提交事务				----
	
	
	余额应该为1500元才对，请看T5时间点，事务A此时查询的余额为0，这个数据就是脏数据，
	他是事务B造成的，很明显是事务没有进行隔离造成的。
	
### 读已提交(READ_COMMITTED)
	读已提交是不同的时候执行的时候只能获取到已经提交的数据。这样就不会出现上面的脏读的情况了。
	
	时间	事务A(存款)			事务B(取款)
	T1		开始事务			----
	T2		----				开始事务
	T3		----				查询余额(1000元)
	T4		查询余额(1000元)	----
	T5		----				取出1000元(余额0元)
	T6		----				提交事务
	T7		查询余额(0元)		----
	T8		提交事务			----
	
	事务A其实除了查询两次以外，其他什么事情都没做，结果钱就从1000变成0了，这就是不可重复读的问题。
	
### 可重复读(REPEATABLE_READ)
	可重复读就是保证事务处理过程中，多次读取同一个数据时，该数据的值和事务开始时刻是一致的。
	因此该事务级别控制了不可重复读和脏读，但是哟额能出现幻读的数据。
	
	幻读概念
	幻读就是指同样的事务操作,在前后两个时间段内执行同一个数据的读取,可能出现不一致的结果。
	
	时间	事务A(存款)			事务B(取款)
	T1		开启事务			----
	T2		----               开启事务
	T3		统计总存款(1000元)	----
	T4		----                存入100元
	T5		----                提交事务
	T6		提交总存款(1100)    ----
	T7		提交事务			----
	
	银行工作人员在一个事务中多次统计总存款时看到的结果不一致。如果要解决幻读，那只能使用顺序读了。
	
### 顺序读(SERIALIZABLE)
	顺序读是最高事务隔离级别，他要求所有的事务排队顺序执行，既事务只能一个接一个地处理，不能行法。

### 事务隔离级别对比

	事务隔离级别                脏读	不可重复读	幻读
	读未提交(READ_UNCOMMITTED)  允许	允许		允许
	读已提交(READ_COMMITTED)    禁止	允许		允许
	可重复读(REPEATABLE_READ)   禁止	禁止		允许
	顺序读(SERIALIZABLE)        禁止	禁止		禁止


	4种事务隔离级别从上到下，级别越高，并发性越差，安全性就越来越高。一般数据默认级别是读已提交或可重复读。
	
## 持久性(Duration)
	事务的持久性是指事务一旦提交后，数据库的数据必须被永久的保存下来，及时服务器系统崩溃或服务器宕机等故障。
	只要数据库重新启动。那么一定能够将其恢复到事务成功结束后的状态。
	